---
import Layout from "@/layouts/Layout.astro"
import {API,FOTO_URL, INE_API} from "src/Globals.js"
import {XCircle} from "lucide-astro"
import Header from "@/components/Header.astro"

async function getGalerias() {
    const res = await fetch(`${API}/galerias?populate[Fotos][fields][0]=url`)
    if (!res.ok){
        throw new Error('ERROR EN FETCH')
    }
    const { data } = await res.json()
    
    const Fotos = data.map(galeria => {
        galeria.attributes.Fotos.data.forEach(foto => {
            foto.attributes.url = `${FOTO_URL}${foto.attributes.url}`
        })
        return galeria
    })

    return Fotos
    
}

let seccion = 940
function getCasillas() {
  fetch(`${INE_API}rasgo-with-cmr?e=31&s=${seccion}`, {
    method: 'GET',
    headers: {
      'x-utc-service-id': 'ubicatucasilla',
      'x-utc-version-id': '2024'
    }
  })
  .then(response => {
    console.log(response)
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(data => {
    console.log(data);
    // Aquí puedes manejar la respuesta JSON como desees
  })
  .catch(error => {
    console.error('There was an error with the fetch operation:', error);
  });
}

getCasillas()


const galerias = await getGalerias()
console.log(galerias)


---

<style>
    body{
        background-color: #dcdcdc;
    }
</style>
<Layout title="Galeria de fotos">
    <Header/>
    <dialog id="fotoDialog" class="fixed border-none rounded-lg top-0 left-0 w-full h-full flex justify-center items-center bg-gray-700 bg-opacity-75 hidden">
        <img class="h-auto max-h-full max-w-full object-contain" id="fotoDialogImg" src="" alt="Foto completa"/>
        <a onclick="document.getElementById('fotoDialog').classList.add('hidden'); document.getElementById('fotoDialog').close()" class="absolute top-0 right-0 m-4 text-black cursor-pointer"><XCircle fill="white"/></a>
    </dialog>
    <div class="pt-24 xl:p-24 2xl:p-40">
        
        {
            galerias.map(galeria => (
                <div key={galeria.id}>
                    <h2 class="text-center fuente1">Galería {galeria.attributes.municipio}</h2>
                    <div class="flex flex-wrap justify-center">
                        {
                            galeria.attributes.Fotos.data.map((foto, index ) => (
                            <div class="rounded-lg m-7 overflow-hidden cursor-pointer hover:shadow-2xl">
                                <img class="xl:w-64 h-64 w 2xl:w-80 h-80 cursor-pointer object-cover hover:scale-110 transform-gpu shadow-xl transition-all duration-200 scale" 
                                    key={foto.id} 
                                    src={foto.attributes.url} 
                                    alt={`Foto ${foto.id}`}
                                    onclick={`document.getElementById('fotoDialogImg').src='${foto.attributes.url}'; document.getElementById('fotoDialog').classList.remove('hidden'); document.getElementById('fotoDialog').showModal(); `}
                                    class={`w-1/5 ${index % 5 === 0 ? 'clear-left' : ''}`}
                                    loading="lazy"
                                />
                            </div>
                            ))
                        }
                    </div>
                </div>
            ))
        }
    </div>

</Layout>

