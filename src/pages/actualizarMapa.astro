---
import Layout from "@/layouts/Layout.astro";
---

<Layout title="Actualizar mapa">
    <style>
        body {
            background-color: azure;
        }
    </style>
    <div class="bg-gray-100 p-4">
        <div class="flex justify-center space-x-4">
            <!-- Tabla Izquierda -->
            <div class="w-1/2">
                <h2 class="text-lg font-bold mb-2">Lista de municipios</h2>
                <table class="w-full bg-white border border-gray-200 shadow-md">
                    <thead>
                        <tr class="text-left">
                            <th class="px-4 py-2">Nombre</th>
                            <th class="px-4 py-2">Acción</th>
                        </tr>
                    </thead>
                    <tbody id="municipios">
                        <!-- Los datos se insertarán aquí -->
                    </tbody>
                </table>
            </div>
            <!-- Tabla Derecha -->
            <div class="w-1/2">
                <h2 class="text-lg font-bold mb-2">Municipios visitados</h2>
                <table class="w-full bg-white border border-gray-200 shadow-md">
                    <thead>
                        <tr class="text-left">
                            <th class="px-4 py-2">Nombre</th>
                            <th class="px-4 py-2">Acción</th>
                        </tr>
                    </thead>
                    <tbody id="municipiosVisitados">
                        <!-- Los datos se insertarán aquí -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</Layout>

<script>
    async function fetchJsonData(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error("Error en el fetch");
            }
            return await response.json();
        } catch (error) {
            console.error("Error:", error);
            return [];
        }
    }

    async function agregarMunicipio(id) {
        try {
            const response = await fetch("https://contactocoahuila.purpuraamerida.com/atencion/politica/agregarMunicipio/"+id);
            //const data = await response.json();
            if (!response.ok) {
                throw new Error("Error al agregar municipio");
            }
            console.log(response.json())
            console.log(`Municipio con ID ${id} agregado exitosamente.`);
            alert("municipo agregado");
            window.location.reload();
        } catch (error) {
            console.error("Error:", error);
        }
    }

    async function renderMunicipios() {
        const data = await fetchJsonData(
            "https://contactocoahuila.purpuraamerida.com/atencion/politica/municipios",
        );
        const municipios = data.map((item) => ({
            id: item.id,
            municipio: item.municipio,
        }));
        const tablaIzquierda = document.getElementById("municipios");
        municipios.forEach((municipio) => {
            const row = document.createElement("tr");
            row.innerHTML = `
      <td class="px-4 py-2">${municipio.municipio}</td>
      <td class="px-4 py-2">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded">Agregar</button>
      </td>
    `;
            row.querySelector("button").addEventListener("click", () =>
                agregarMunicipio(municipio.id),
            );
            tablaIzquierda.appendChild(row);
        });
    }

    async function renderMunicipiosVisitados() {
        const data = await fetchJsonData(
            "https://contactocoahuila.purpuraamerida.com/atencion/politica/municipiosVisitados",
        );
        const municipios = data.map((item) => ({
            id: item.id,
            municipio: item.municipio,
        }));
        const tablaDerecha = document.getElementById("municipiosVisitados");
        municipios.forEach((municipio) => {
            const row = document.createElement("tr");
            row.innerHTML = `
      <td class="px-4 py-2">${municipio.municipio}</td>
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded">Eliminar</button>
      <td class=" py-2">
        
      </td>
    `;      row.querySelector("button").addEventListener("click", () =>
                agregarMunicipio(municipio.id),
            );
            tablaDerecha.appendChild(row);
        });
    }

    renderMunicipios();
    renderMunicipiosVisitados();

    
</script>
